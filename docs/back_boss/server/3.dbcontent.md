---
title: è¿žæŽ¥æœåŠ¡å™¨
sidebar_label: è¿žæŽ¥æœåŠ¡å™¨
---
:::info
æœ¬æ–‡å‚è€ƒè¿žæŽ¥ï¼š[**é•¿ä¹æœªå¤®**](https://clwy.cn/chapters/node-express-sequelize)
:::

## æœ¬åœ°å®‰è£…mysqlæ•°æ®åº“
æˆ‘ä¹‹å‰ç”¨çš„æ˜¯`docker`çš„`desktop`ç‰ˆæœ¬å‘çŽ°å¹¶ä¸æ˜¯å¾ˆå¥½ç”¨å•Šï¼Œå¯¹æˆ‘è¿™ç§è‹±æ–‡è·Ÿshitä¸€æ ·çš„äººæ¥è®²ï¼Œæ˜¯æŠ˜ç£¨ï¼Œåæ§½ä¸€ä¸‹å“ˆï¼Œä¸ªäººçœ‹æ³•ã€‚è¿™é‡Œæˆ‘æ¢æˆäº†å›½äº§çš„[å°çš®é¢æ¿](https://www.xp.cn/)ã€‚éžå¸¸å¥½ç”¨çš„ï¼Œå®‰è£…åˆ°ä½¿ç”¨ï¼Œæœ‰æ‰‹å°±è¡Œå“ˆå®¶äººä»¬ï¼Œæ æ çš„ï¼
## å®‰è£…Sequelize
æœ¬åœ°å®‰è£…å¥½`mysql`ä¹‹åŽï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ï¼Œåå­—å’Œç”¨æˆ·éšæ„ï¼Œä½†æ˜¯ç”¨æˆ·ä¸èƒ½æ˜¯`root`

> è¿™é‡Œæ•°æ®åº“é¢æ¿æˆ‘ä½¿ç”¨çš„æ˜¯`Navicat 16`å°ä¼™ä¼´ä»¬ç”¨å…¶ä»–çš„ä¹Ÿéƒ½å¯ä»¥çš„ï¼Œå¦‚æžœéœ€è¦å¯ä»¥è”ç³»æˆ‘ï¼Œå…è´¹æä¾›ç ´è§£ç‰ˆå™¢~ðŸ¤­


é¡¹ç›®æ ¹ç›®å½•ä¾æ¬¡è¿è¡Œ
```cmd
npm install sequelize -S
npm install mysql2 -S
npm install sequelize-cli -g
sequelize init
```
è¿è¡Œå®Œæˆä¹‹åŽä¼šå‘çŽ°é¡¹ç›®ä¸­å¤šå‡ºäº†å‡ ä¸ªæ–‡ä»¶å¤¹å’Œæ–‡ä»¶

```cmd
.
â”œâ”€â”€ config
â”‚   â””â”€â”€ config.json
â”œâ”€â”€ migrations
â”œâ”€â”€ models
â”‚   â””â”€â”€ index.js
â””â”€â”€ seeders

```
+ `config` æ˜¯é…ç½®çš„æ„æ€ï¼Œè¿™é‡Œæ”¾çš„ä¹Ÿå°±æ˜¯ `sequelize` æ‰€éœ€è¦çš„è¿žæŽ¥æ•°æ®åº“çš„é…ç½®æ–‡ä»¶ã€‚
+ `migrations` æ˜¯è¿ç§»çš„æ„æ€ï¼Œå¦‚æžœä½ éœ€è¦å¯¹æ•°æ®åº“åšæ–°å¢žè¡¨ã€ä¿®æ”¹å­—æ®µã€åˆ é™¤è¡¨ç­‰ç­‰æ“ä½œï¼Œå°±éœ€è¦åœ¨è¿™é‡Œæ·»åŠ  è¿ç§»æ–‡ä»¶ äº†
+ `models` é‡Œé¢å­˜æ”¾çš„æ˜¯æ¨¡åž‹æ–‡ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ `sequelize` æ¥æ‰§è¡Œ CRUDï¼Œä¹Ÿå°±æ˜¯ åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤æ•°æ®ï¼Œå°±éœ€è¦ç”¨è¿™é‡Œçš„æ¨¡åž‹äº†ã€‚æ¯ä¸ªæ¨¡åž‹éƒ½å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ã€‚
+ `seeders`ï¼Œæ˜¯å­˜æ”¾çš„ç§å­æ–‡ä»¶ã€‚ä¸€èˆ¬ä¼šå°†ä¸€äº›éœ€è¦æ·»åŠ åˆ°æ•°æ®è¡¨çš„æµ‹è¯•æ•°æ®å­˜åœ¨è¿™é‡Œã€‚åªéœ€è¦è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œæ•°æ®è¡¨ä¸­å°±ä¼šè‡ªåŠ¨å¡«å……è¿›æµ‹è¯•å†…å®¹äº†ã€‚

## é…ç½®config
æˆ‘ä»¬éœ€è¦åœ¨`config`æ–‡ä»¶å¤¹ä¸­çš„`config.json`æ–‡ä»¶ä¸­é…ç½®è¿žæŽ¥æ•°æ®åº“æ‰€éœ€è¦çš„ä¿¡æ¯

ä¾‹å¦‚ï¼š
```js title="config.json"
{
  "development": {
    "username": "admin",
    "password": "123456",
    "database": "development",
    "host": "127.0.0.1",
    "dialect": "mysql"
  },
  "test": {
    "username": "root",
    "password": null,
    "database": "development",
    "host": "127.0.0.1",
    "dialect": "mysql"
  },
  "production": {
    "username": "root",
    "password": null,
    "database": "database_production",
    "host": "127.0.0.1",
    "dialect": "mysql"
  }
}
```
ä»¥ä¸Šåˆ†åˆ«å¯¹åº”ç€å¼€å‘çŽ¯å¢ƒã€æµ‹è¯•çŽ¯å¢ƒå’Œç”Ÿäº§çŽ¯å¢ƒæ•°æ®åº“çš„é…ç½®ï¼ŒæŒ‰éœ€æ±‚æ”¹å³å¯ã€‚
æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠåŽŸæœ‰çš„`models`æ–‡ä»¶å¤¹ä¸‹çš„`index.js`æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸€ä¸‹ï¼Œå°†`sequelize`æ”¹ä¸ºè¿žæŽ¥æ± è¿žæŽ¥
> æœ€å¼€å§‹çš„ä»£ç æˆ‘å¿˜äº†æ˜¯å•¥æ ·äº†ï¼Œæˆ‘ç›´æŽ¥æŠŠå†…å®¹è´´å‡ºæ¥åšä¸€ä¸ªé«˜äº®å§
```js title="/models/index.js"
'use strict';

const fs = require('fs');
const path = require('path');
const Sequelize = require('sequelize');
const process = require('process');
const basename = path.basename(__filename);
const env = process.env.NODE_ENV || 'development';
const config = require(__dirname + '/../config/config.json')[env];
const db = {};

let sequelize;
if (config.use_env_variable) {
  sequelize = new Sequelize(process.env[config.use_env_variable], {
    ...config, pool: {
      max: 5,
      min: 0,
      acquire: 30000,
      idle: 10000
    }
  });
} else {
  sequelize = new Sequelize(config.database, config.username, config.password, {
    ...config, pool: {
      max: 5,
      min: 0,
      acquire: 30000,
      idle: 10000
    }
  });
}
(async () => {
  try {
    // highlight-start
    // æ”¹ä¸ºè¿žæŽ¥æ± è¿žæŽ¥
    await sequelize.authenticate();
    console.log('Connection has been established successfully.');
    // è¿™é‡Œæ˜¯æ¯æ¬¡æ¨¡åž‹æ›´æ–°éƒ½ä¼šæ›´æ–°åˆ°æ•°æ®åº“ï¼Œçº¿ä¸Šæ…Žé‡~ï¼ï¼ï¼ï¼
    await sequelize.sync({ alter: true });
  } catch (error) {
    console.error('Unable to connect to the database:', error);
  }
  // highlight-end
})();

fs
  .readdirSync(__dirname)
  .filter(file => {
    return (
      file.indexOf('.') !== 0 &&
      file !== basename &&
      file.slice(-3) === '.js' &&
      file.indexOf('.test.js') === -1
    );
  })
  .forEach(file => {
    const model = require(path.join(__dirname, file))(sequelize, Sequelize.DataTypes);
    db[model.name] = model;
  });

Object.keys(db).forEach(modelName => {
  if (db[modelName].associate) {
    db[modelName].associate(db);
  }
});

db.sequelize = sequelize;
db.Sequelize = Sequelize;

module.exports = db;

```